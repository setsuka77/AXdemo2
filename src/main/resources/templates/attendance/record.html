<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>勤怠管理登録 | Analix社内管理システム</title>
	<link rel="stylesheet" href="/login/styles.css">
</head>

<body>
	<div class="attendance-container">

		<tr>
			<td>
				<div class="info-container">
					<div class="info-item">ユーザー名: <span th:text="${loginUser.name}"></span></div>
					<div class="info-item">ユーザーID: <span th:text="${loginUser.id}"></span></div>
					<div class="info-item">ステータス:</div>
				</div>
			</td>
		</tr>


		<div th:if="${error}" class="alert alert-danger" role="alert">
			<p th:text="${error}"></p>
		</div>

		<div class="row">

			<form id="attendance-form" th:action="@{/attendance}" method="post" onsubmit="return validateDisplay();"
				th:if="${loginUser.role != '2'}">
				<div class="form-group">
					表示年月:
					<select id="year" name="year">
						<option value="">年を選択</option>
						<option th:each="year : ${yearList}" th:value="${year}" th:text="${year}"></option>
					</select>
					<span>年</span>

					<select id="month" name="month">
						<option value="">月を選択</option>
						<option th:each="month : ${monthList}" th:value="${month}" th:text="${month}"></option>
					</select>
					<span>月</span>
					<button type="submit" name="display" class="button">表示</button>
					<span id="year-error" class="error-message">表示させたい年月を指定してください。</span>

				</div>
			</form>
		</div>

		<form id="register-form" th:action="@{/attendance}" method="post">
			<div class="button-group">
				<button type="submit" th:if="${loginUser.role == '2'}" name="rejected" class="button">却下</button>
				<button type="submit" th:if="${loginUser.role == '2'}" name="approval" class="button">承認</button>
				<button type="submit" th:if="${loginUser.role != '2'}" name="request" class="button">承認申請</button>
				<button type="submit" th:if="${loginUser.role != '2'}" name="regist" class="button">登録</button>
			</div>

			<!-- 申請一覧 マネージャのみ表示 -->
			<table class="table table-hover" border="1" cellspacing="0" th:if="${loginUser.role == '2'}">
				<thead>
					<tr>
						<th>承認申請者</th>
						<th>申請対象年月</th>
						<th>申請日</th>
					</tr>
				</thead>
				<tbody>
					<td></td>
					<!--<td th:text="${monthlyAttendanceReq.targetYearMonth}"></td>
					<td th:text="${monthlyAttendanceReq.date}"></td>-->
				</tbody>
			</table>

			<!-- 登録時入力エラーメッセージ表示 -->
			<div th:if="${registerError}" class="alert alert-danger" role="alert">
				<p th:utext="${registerError}"></p>
			</div>

			<table class="table table-hover" border="1" cellspacing="0">
				<thead>
					<tr>
						<th>日付</th>
						<th>曜日</th>
						<th class="status-column">勤務状況</th>
						<th class="time-column">出勤時間</th>
						<th class="time-column">退勤時間</th>
						<th>備考</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="calendar, iterStat : ${calendarList}">
						<td th:text="${calendar.getFormattedDate()}">
							<input type="hidden" name="date" th:value="${calendar.date}" />
						</td>
						<td th:text="${calendar.dayOfWeek}"></td>
						<td>
							<select th:name="'dailyAttendanceList[' + ${iterStat.index} + '].status'"
								class="form-control">
								<option value="" hidden> </option>
								<option value="0"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 0}">通常出勤
								</option>
								<option value="1"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 1}">休日
								</option>
								<option value="2"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 2}">祝日
								</option>
								<option value="3"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 3}">遅刻
								</option>
								<option value="4"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 4}">有給
								</option>
								<option value="5"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 5}">欠勤
								</option>
								<option value="6"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 6}">早退
								</option>
								<option value="7"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 7}">
									時間外勤務
								</option>
								<option value="8"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 8}">振替出勤
								</option>
								<option value="9"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 9}">振替休日
								</option>
								<option value="10"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 10}">
									代替出勤
								</option>
								<option value="11"
									th:selected="${attendanceForm.dailyAttendanceList[iterStat.index].status == 11}">
									代替休日
								</option>
							</select>
						</td>
						<td>
							<input type="text" th:name="'dailyAttendanceList[' + ${iterStat.index} + '].startTime'"
								th:value="${attendanceForm.dailyAttendanceList[iterStat.index].startTime}"
								class="form-control input-time">
						</td>
						<td>
							<input type="text" th:name="'dailyAttendanceList[' + ${iterStat.index} + '].endTime'"
								th:value="${attendanceForm.dailyAttendanceList[iterStat.index].endTime}"
								class="form-control input-time">
						</td>
						<td>
							<input type="text" th:name="'dailyAttendanceList[' + ${iterStat.index} + '].remarks'"
								th:value="${attendanceForm.dailyAttendanceList[iterStat.index].remarks}"
								class="form-control note">
						</td>
					</tr>
				</tbody>
			</table>
		</form>
	</div>
	<script>
		//表示時必須チェック
		function validateDisplay() {
			const year = document.getElementById('year').value;
			const month = document.getElementById('month').value;
			const errorElement = document.getElementById('year-error');

			if (!year || !month) {
				errorElement.style.display = 'block';
				return false; // フォームの送信をキャンセル
			} else {
				errorElement.style.display = 'none';
				return true; // フォームの送信を許可
			}
		}

		//登録時必須チェック
		//承認申請ボタンを活性化させる

	</script>

</body>

</html>
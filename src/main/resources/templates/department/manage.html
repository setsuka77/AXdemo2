<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>部署管理登録 | Analix社内管理システム</title>
	<link rel="stylesheet" href="/login/css/styles.css">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>

	<div class="container">
		<div class="form-container">
			<tr>
				<div class="header-button">
					<form th:action="@{/department/manage}" method="post">
						<button type="submit" name="back" class="button">メニュー</button>
					</form>
					<h2>部署管理</h2>
					<a th:href="@{/logout}"><button>ログオフ</button></a>
				</div>
			</tr>

			<!-- 部署管理フォーム -->
			<form th:action="@{/department/manage}" method="post" th:object="${departmentForm}">

				<table>

					<!-- 新規部署名入力 -->
					<tr>
						<td><label for="newDepartment">部署名</label></td>
						<td>
							<input type="text" id="newDepartment" name="newDepartment" 
								onkeyup="searchDepartment()" autocomplete="off"/>
						</td>
						<!--<td><small>新規登録の場合は新規部署名を入力</small></td>-->
					</tr>

					<!-- 登録済の部署表示選択プルダウン、各種ボタン -->
					<tr>
						<td><label for="currentDepartment">登録済の部署</label></td>
						<td>
							<select name="currentDepartment" id="currentDepartment">
								<option value="">選択してください</option>
								<option th:each="department : ${departments}" 
										value="${department.name}"
										th:text="${department.name}">選択肢</option>
							</select>
						</td>
						<td><button type="submit" name="register" class="button">新規登録</button></td>
						<td><button type="submit" name="update" class="button">部署名変更</button></td>
						<td><button type="submit" name="deactivate" class="button">停止</button></td>
					</tr>

				</table>
			</form>

		</div>
	</div>

	<script>
		
		//リアルタイムで検索結果を表示
		document.getElementById('newDepartment').addEventListener('input', function () {
			const name = this.value;

			// Fetch APIで検索リクエストを送信
			fetch(`/login/department/search?name=${name}`)
				.then(response => response.json())
				.then(data => {
					const select = document.getElementById('currentDepartment');
					select.innerHTML = '<option value="">選択してください</option>'; // クリア

					// 検索結果をプルダウンに表示
					data.forEach(department => {
						const option = document.createElement('option');
						option.value = department.name;
						option.textContent = department.name;
						select.appendChild(option);
						
					});
					
				})
				.catch(error => console.error('Error:', error));
		});
		
	</script>

</body>

</html>